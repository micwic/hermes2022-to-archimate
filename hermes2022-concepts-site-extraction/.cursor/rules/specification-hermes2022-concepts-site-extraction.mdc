---
description: Sp√©cification g√©n√©rale du module hermes2022-concepts-site-extraction
alwaysApply: true
---

# specification-hermes2022-concepts-site-extraction.mdc: Sp√©cification g√©n√©rale du module hermes2022-concepts-site-extraction

Chemin : hermes2022-to-archimate/hermes2022-concepts-site-extraction/.cursor/rules/

> Cr√©√© le : 2025-08-16
> Derni√®re mise √† jour : 2025-11-01

## Description g√©n√©rale

- La m√©thode HERMES des gestion de projet et de programme de la Conf√©d√©ration Helv√©tique est d√©crite en anglais sur le site <https://www.hermes.admin.ch/en/>
- **Finalit√© du module** : Extraire automatiquement les concepts HERMES2022 depuis les pages officielles sp√©cifiques et les transformer en fichiers interm√©diaires structur√©s JSON valid√©s
- **Port√©e du module** : Extraction cibl√©e des concepts de la m√©thode HERMES2022 avec leur contexte et articulation g√©n√©rale, selon la hi√©rarchie officielle (1=Initiation, 2=Execution avec 2.1=Concept, 2.2=Implementation, 2.3=Deployment, 3=Closure)
- **Interface de sortie** : Fichiers JSON conformes aux sch√©mas d√©finis dans le module hermes2022-extraction-files

## Contexte

- Sp√©cification amont @.cursor/rules/specification-hermes2022-to-archimate.mdc
- Les m√©thodes HERMES de gestion de portefeuille et de gestion des applications sont hors contexte, elles sont ignor√©es
- La m√©thode HERMES2022 de gestion de projet et de programme de la Conf√©d√©ration Helv√©tique est d√©crite en plusieurs langues : allemand, fran√ßais, italien et anglais
- La racine du site <https://www.hermes.admin.ch> est modifi√©e automatiquement √† la langue par d√©faut ou est celle d√©finie dans l'url lors de la requ√™te
- L'url du site en allemand est <https://www.hermes.admin.ch/de/>
- L'url du site en fran√ßais est <https://www.hermes.admin.ch/fr/>
- L'url du site en italien est <https://www.hermes.admin.ch/it/>
- L'url du site en anglais est <https://www.hermes.admin.ch/en/>

## Objectifs

- Faire extraire par l'IA les concepts HERMES2022 jug√©s pertinents pour le projet des pages identifi√©es comme pertinentes du site internet de r√©f√©rence dans la langue souhait√©e.
- Faire transformer par l'IA les donn√©es jug√©es pertinentes pour les enregistrer dans des fichiers interm√©diaires structur√©s, lisibles et v√©rifiables par un humain avant chargement ult√©rieur

## Conception g√©n√©rale

- Un fichier de configuration JSON de l'extraction contient les propri√©t√©s utiles √† celle-ci
- Le processus d'extraction est un agent sp√©cialis√© :<br>- Javascript compatible comme plugin JArchi de Archi<br>- g√©n√©rique et configurable, son ex√©cution conforme est bas√©e sur le contenu du fichier de configuration et sur les d√©finitions de structure du fichier interm√©diaire cible
- L'extraction des contenus du site internet est assur√©e par l'agent sp√©cialis√© √† partir des urls d√©finies pour chaque concept dans le fichier de configuration
- Les transformations sont effectu√©es par l'IA sp√©cialis√©e NuExtract en faisant appel aux APIs disponibles en mode SaaS dans un projet nomm√© HERMES2022 qui peut comprendre des exemples ajustables propres √† chaque contexte directement dans la plateforme SaaS en dehors du code de l'agent.
- Les concept HERMES2022 jug√©s pertinents sont, en plus de la vue g√©n√©rale de la m√©thode dans son ensemble : 1) Les phases, 2) Les sc√©narios, 3) Les modules, 4) Les t√¢ches, 5) Les r√©sultats, 6) Les r√¥les
- les structures cibles de la transformation sont les structures et types d√©finis pour les fichiers interm√©diaires JSON

## Structure de r√©pertoire

| √âl√©ment | Type | Description |
|:--------|:-----|:------------|
| `/src/` | R√©pertoire | Code source de l'agent JavaScript pour l'extraction via APIs NuExtract |
| `/src/nuextract-client.js` | Code | Client logique m√©tier (orchestration, validation, transformation, fallbacks config) - Exports `_testOnly_` pour tests |
| `/src/nuextract-api.js` | Code | Module API (appels HTTP vers APIs NuExtract) - Fonctions pures avec Dependency Injection - Exports normaux |
| `/src/path-resolver.js` | Code | R√©solution robuste des chemins depuis la racine du repository selon @root-directory-governance |
| `/config/` | R√©pertoire | Configuration de l'extraction et param√®tres pour l'agent JS |
| `/config/extraction-config.schema.json` | Sch√©ma | Sch√©ma JSON Schema Draft-07 source de param√©trage avec pattern enum pour configuration technique |

## D√©cisions architecturales et techniques

### Site internet de r√©f√©rence HERMES2022

#### Justification pour le site internet de r√©f√©rence HERMES2022 en anglais

- La documentation de r√©f√©rence du projet est en anglais, les mod√®les Archimate sont donc en anglais, le site de r√©f√©rence √† prendre en consid√©ration pour HERMES2022 celui en anglais (<https://www.hermes.admin.ch/en/>).

#### Description d√©taill√©e pour le site internet de r√©f√©rence HERMES2022

- [2025-08-16] La racine du site internet de r√©f√©rence pour l'extraction des concepts HERMES2022 est <https://www.hermes.admin.ch/en/>. Elle permet de d√©finir la version de la m√©thodologie.
- [2025-10-16] La vue g√©n√©rale de la m√©thodologie est d√©crite dans les pages : <br>- <https://www.hermes.admin.ch/en/project-management/method-overview.html><br>- <https://www.hermes.admin.ch/en/project-management/method-overview/hermes-project-management-method-components.html><br>- <https://www.hermes.admin.ch/en/project-management/method-overview/preface.html>
- [2025-08-16] Les phases sont d√©crites dans les pages : <br>- <https://www.hermes.admin.ch/en/project-management/phases.html><br>- <https://www.hermes.admin.ch/en/project-management/phases/initiation.html><br>- <https://www.hermes.admin.ch/en/project-management/phases/concept.html><br>- <https://www.hermes.admin.ch/en/project-management/phases/implementation.html><br>- <https://www.hermes.admin.ch/en/project-management/phases/deployment.html><br>- <https://www.hermes.admin.ch/en/project-management/phases/execution.html><br>- <https://www.hermes.admin.ch/en/project-management/phases/closure.html>

#### Patterns valid√©s √† suivre suite √† la d√©cision

- **URL RACINE** √† utiliser pour les requ√™tes internet est <https://www.hermes.admin.ch/en/>

#### √âtat d'impl√©mentation de la d√©cision

üöß [En cours de sp√©cification et r√©alisation]

### Approche hybride IA : Javascript et mod√®le LLM sp√©cialis√© NuExtract dans le cloud par API

#### Description d√©taill√©e pour l'approche hybride IA

- [2025-10-14] L'extraction des concepts HERMES2022 utilise une approche hybride en deux phases : Phase 1 avec l'extraction de pages internet de r√©f√©rences par Javascript qui aliment des appels √† l'IA sp√©cialis√©e NuExtract par les APIs disponibles dans le cloud pour synth√©tiser les contenus et assurer la transformation dans le format JSON.
- [2025-08-16] L'approche doit permettre la r√©utilisation des comportements dans d'autres contextes que le projet actuel, notamment avec du param√©trage (autres contenants et contenus, autres instructions pour l'IA).
- [2025-10-14] Le composant doit pouvoir s'ex√©cuter dans Archi avec le plugin JArchi

#### Justification pour l'approche hybride IA avec NuExtract

- NuExtract est un LLM sp√©cialis√© pour l'extraction de donn√©es √† partir de diff√©rentes sources pour transformation dans un format structur√©s tel que JSON
- Une plateforme SaaS est disponible et gratuite avec de faible volume de donn√©es

#### Patterns valid√©s pour l'approche hybride IA

Exemples de la documentation officielle :

```bash
 curl "https://nuextract.ai/api/projects" \
  -H "Authorization: Bearer $NUEXTRACT_API_KEY"
```

```bash
PROJECT_ID="4c64870d-da8c-4718-aea9-fb2f86f07b42"
curl "https://nuextract.ai/api/projects/$PROJECT_ID/extract" \
  -X "POST" \
  -H "Authorization: Bearer $NUEXTRACT_API_KEY" \
  -H "content-type: text/plain" \
  -d "This is a text"
```

```bash
  PROJECT_ID="4c64870d-da8c-4718-aea9-fb2f86f07b42"
curl "https://nuextract.ai/api/projects/$PROJECT_ID/extract" \
  -X "POST" \
  -H "Authorization: Bearer $NUEXTRACT_API_KEY" \
  -H "content-type: application/octet-stream" \
  --data-binary @file_name.ext
```

L'ensemble des APIs NuExtract sont d√©crites dans @hermes2022-concepts-site-extraction/.cursor/rules/nuextract-platform.yaml qui est la r√©f√©rence officielle √† utiliser

#### Anti-Patterns pour l'approche hybride IA √† √©viter

- N√©ant

#### √âtat d'impl√©mentation pour l'approche hybride IA

üöß [En cours de conception et r√©alisation]

### Architecture modulaire selon principes SOLID

#### Description d√©taill√©e pour l'architecture modulaire

- [2025-10-26] L'extraction des concepts HERMES2022 est r√©alis√©e par un agent JavaScript modulaire ex√©cut√© dans JArchi (plugin d'Archi), qui articule les requ√™tes HTTP vers les APIs de NuExtract dans le cloud pour analyser et r√©sumer le contenu des pages HTML, puis g√©n√©rer des fichiers JSON structur√©s avec les synth√®ses op√©r√©es.
- [2025-10-26] L'agent est divis√© en modules distincts selon les principes SOLID :
  - **`nuextract-api.js`** : Couche API/I/O - Appels HTTP purs vers les APIs NuExtract (fonctions pures avec Dependency Injection)
  - **`nuextract-client.js`** : Couche logique m√©tier - Orchestration, validation, transformation, gestion des fallbacks de configuration
  - **`path-resolver.js`** : Module utilitaire - R√©solution robuste des chemins depuis la racine du repository
- [2025-10-26] L'agent g√®re le cycle complet : chargement configuration, validation cl√© API, chargement instructions, r√©solution et validation sch√©mas JSON, g√©n√©ration template, gestion projet NuExtract.
- [2025-10-26] L'agent est con√ßu pour √™tre modulaire, r√©utilisable et int√©gr√© √† l'√©cosyst√®me JArchi de Archi sans d√©pendances externes inutiles.

#### Justification pour l'architecture modulaire

- **Separation of Concerns** : API/I/O s√©par√© de la logique m√©tier et des fallbacks de configuration
- **Single Responsibility Principle (SRP)** : Chaque module a une responsabilit√© unique et claire
- **Dependency Injection** : √âlimination du couplage fort via variables globales, toutes les d√©pendances pass√©es en param√®tres
- **Testabilit√©** : Logique m√©tier testable avec API mock√©e, fonctions pures facilement testables
- **Maintenabilit√©** : Changements API isol√©s sans impact sur logique m√©tier
- **R√©utilisabilit√©** : Module API r√©utilisable dans d'autres contextes (pas de d√©pendance √† une config sp√©cifique)
- **Simplicit√© et Int√©gration** : Langage de r√©f√©rence qui permet d'utiliser les APIs Java natives (java.net.http.HttpClient) pour les requ√™tes HTTP et les appels aux APIs de NuExtract, √©vitant les d√©pendances Node.js ou Axios, et permettant une ex√©cution directe dans JArchi de Archi.

#### Patterns valid√©s pour l'architecture modulaire

- **Fonctions pures API** : `async function inferTemplateAsync(hostname, port, path, apiKey, description, timeout) { ... }`
- **Exports normaux API** : `module.exports = { inferTemplateAsync, getJobStatus, ... }` (interface publique)
- **Exports _testOnly_ client** : `module.exports = { _testOnly_loadGlobalConfig, _testOnly_generateTemplate, ... }` (logique m√©tier pour tests)
- **Import module API** : `const nuextractApi = require('./nuextract-api.js')`
- **Appels avec DI** : `await nuextractApi.inferTemplateAsync(hostname, port, path, apiKey, description, 60)`
- **Fallbacks dans client** : `const hostname = config?.nuextract?.baseUrl || 'nuextract.ai'`
- **R√©solution chemins** : `resolveFromRepoRoot(config.nuextract.apiKeyFile)` depuis `path-resolver.js`
- **Requ√™tes HTTP natives** : Utilisation de `https` (Node.js) ou `java.net.http.HttpClient` (JArchi) pour les appels vers NuExtract
- **Gestion asynchrone** : Promesses JavaScript pour les requ√™tes non-bloquantes
- **Validation JSON Schema** : Utilisation de `@apidevtools/json-schema-ref-parser` pour r√©solution des `$ref` et `Ajv` pour validation conformit√© JSON Schema Draft-07

#### Anti-Patterns pour l'architecture modulaire √† √©viter

- **Variables globales** : √âviter GLOBAL_CONFIG dans nuextract-api.js ‚Üí **Solution** : Param√®tres explicites ‚Üí **R√®gle** : Dependency Injection
- **Appels internes directs** : √âviter `await inferTemplateAsync(...)` dans le m√™me module ‚Üí **Solution** : Import depuis module API ‚Üí **R√®gle** : S√©paration obligatoire selon SRP
- **Logique m√©tier dans API** : √âviter la logique de transformation ou fallbacks dans nuextract-api.js ‚Üí **Solution** : API = HTTP uniquement ‚Üí **R√®gle** : Separation of Concerns
- **Exports _testOnly_ dans API** : √âviter dans nuextract-api.js ‚Üí **Solution** : Exports normaux ‚Üí **R√®gle** : Interface publique claire
- **God Module** : √âviter d'ajouter d'autres responsabilit√©s (parsing, validation) dans nuextract-api.js ‚Üí **Solution** : Cr√©er modules d√©di√©s ‚Üí **R√®gle** : Single Responsibility
- **D√©pendances externes lourdes** : √âviter Axios ou libs Node.js inutiles ‚Üí **Solution** : APIs Java natives pour JArchi ‚Üí **R√®gle √† adopter** : Minimalisme pour int√©gration JArchi
- **Gestion d'erreurs insuffisante** : √âviter les timeouts infinis ‚Üí **Solution** : Timeouts explicites ‚Üí **R√®gle √† adopter** : Robustesse et non-blocage de l'UI

#### √âtat d'impl√©mentation pour l'architecture modulaire

‚úÖ [Fonctionnalit√© r√©alis√©e - 2025-10-26]

- ‚úÖ **Module API** : `nuextract-api.js` cr√©√© avec 7 fonctions pures (exports normaux)
- ‚úÖ **Module client** : `nuextract-client.js` refactoris√© (logique m√©tier uniquement, exports `_testOnly_`)
- ‚úÖ **Module path-resolver** : `path-resolver.js` cr√©√© selon @root-directory-governance
- ‚úÖ **R√©solution sch√©mas** : Int√©gration `@apidevtools/json-schema-ref-parser` et `Ajv` pour r√©solution/validation JSON Schema Draft-07

### Int√©gration des APIs NuExtract pour l'extraction structur√©e

#### Description d√©taill√©e pour l'int√©gration des APIs NuExtract

- [2025-10-14] L'agent JavaScript utilise les APIs de NuExtract (mod√®le open source 3.8B bas√© sur Phi-3-mini) pour extraire des donn√©es structur√©es depuis du texte ou HTML vers JSON, garantissant un JSON valide et respectueux des sch√©mas.
- [2025-10-16] Les APIs NuExtact sont d√©crites dans @/home/micwic/gitRepositories/hermes2022-to-archimate/hermes2022-concepts-site-extraction/.cursor/rules/nuextract-platform.yaml
- [2025-10-16] GET /api/projects permet de lister les projets disponibles pour le compte dans dans la plateforme SaaS nuextact.ai, cela permet de d√©terminer {PROJECT_ID} pour HERMES2022 si il existe d√©j√† dans la plateforme SaaS nuextact.ai pour le compte.
- [2025-10-16] La cl√© API valable est stock√©e dans @hermes2022-concepts-site-extraction/config/nuextract-api-key.key
- [2025-10-16] POST /api/projects permet de cr√©er un projet et de d√©terminer {PROJECT_ID} pour HERMES2022 si un tel projet n'existe pas encore dans la plateforme SaaS nuextact.ai. Le projet est cr√©√© avec son template associ√© qui doit exister au pr√©alable dans le format requis par NuExtract
- [2025-10-16] POST /api/infer-template permet de cr√©er un Template NuExtract √† partir d'une description textuelle. Dans le contexte du projet, il faut fusionner les instructions textuelles de @/home/micwic/gitRepositories/hermes2022-to-archimate/hermes2022-concepts-site-extraction/config/instructions-template-nuextract.md avec les formats JSON pertinents, avec y compris les √©ventuelles r√©f√©rences (Exemple : "phases": {"$ref": "./hermes2022-phases.json"}) dans un seul format JSON homog√®ne.
- [2025-10-16] PUT /api/projects/{projectId}/template permet de mettre √† jour le template pour un projet d√©j√† existant
- [2025-10-17] POST /api/projects/{projectId}/infer-text permet d'ex√©cuter une extraction sur la base d'un texte dans le cadre fix√© pour le projet √† savoir sur la base d'un template NuExtract et des exemples de transformation fournis pour les param√®tres d√©finis. Dans le contexte du projet, il faut fusionner les instructions textuelles conform√©ment √† la s√©quence d√©finie dans @hermes2022-concepts-site-extraction/config/extraction-hermes2022-main.md avec avec les contenus HTML extrait des pages de r√©f√©rences correspondantes
- [2025-10-14] Gestion des quotas : L'API supporte des requ√™tes gratuites avec limites (ex. : 1000 requ√™tes/mois), et payantes pour plus de volume ; l'agent inclut un suivi des usages.

#### Justification pour l'int√©gration des APIs NuExtract

- **Pr√©cision et Fiabilit√©** : Mod√®le sp√©cialis√© pour extraction HTML‚ÜíJSON, surpassant les mod√®les g√©n√©ralistes pour cette t√¢che, avec validation automatique du JSON.
- **S√©curit√© et Conformit√©** : Utilisation de la cl√© API personnelle (pas de stockage sensible externe), respect des licences MIT et lois suisses.
- **Int√©gration avec JArchi** : APIs REST simples, compatibles avec java.net.http.HttpClient, sans d√©pendances suppl√©mentaires.
- **√âvolutivit√©** : Support de sch√©mas personnalis√©s pour diff√©rents concepts HERMES2022, et possibilit√© d'extension √† d'autres mod√®les IA.

#### Patterns valid√©s pour l'int√©gration des APIs NuExtract

- **Authentification Bearer** : Utilisation de l'en-t√™te `Authorization: Bearer <cl√© JWT>` pour s√©curiser les requ√™tes avec la cl√© d√©finie dans @hermes2022-concepts-site-extraction/config/nuextract-api-key.key
- **Gestion des Quotas** : Impl√©mentation d'un compteur d'usage dans l'agent, avec logging pour √©viter les d√©passements.
- **Validation de R√©ponse** : Parsing de la r√©ponse JSON avec v√©rification des erreurs (ex. : code 429 pour quota d√©pass√©).

#### Anti-Patterns pour l'int√©gration des APIs NuExtract √† √©viter

- **Utilisation sans authentification** : √âviter les requ√™tes non authentifi√©es ‚Üí **Solution** : Toujours inclure la cl√© Bearer ‚Üí **R√®gle √† adopter** : S√©curit√© des acc√®s API.
- **D√©passement de quotas** : √âviter les requ√™tes excessives ‚Üí **Solution** : Suivi et limites ‚Üí **R√®gle √† adopter** : Gestion proactive des ressources.
- **Hardcodage de la cl√©** : √âviter de coder la cl√© en dur ‚Üí **Solution** : Variable d'environnement ou config ‚Üí **R√®gle √† adopter** : S√©curit√© et maintenabilit√©.

#### √âtat d'impl√©mentation pour l'int√©gration des APIs NuExtract

‚úÖ [Int√©gration r√©alis√©e dans nuextract-api.js - 2025-10-26]

- ‚úÖ **7 fonctions API** : inferTemplateFromDescription, inferTemplateFromDescriptionAsync, getJobStatus, pollJobUntilComplete, getNuExtractProjects, createNuExtractProject, putProjectTemplate
- ‚úÖ **Gestion timeouts** : Timeouts explicites pour toutes les requ√™tes HTTP (sync: 35s, async: 10s, jobs: 5s, projects: 10s)
- ‚úÖ **Authentification Bearer** : En-t√™te `Authorization: Bearer <cl√© JWT>` sur toutes les requ√™tes
- ‚úÖ **Gestion erreurs** : Messages d'erreur contextualis√©s avec Error Cause (ES2022) pour pr√©server stack trace

### Validation de la cl√© API avec jsonwebtoken

#### Description d√©taill√©e pour la validation de la cl√© API

- [2025-10-25] La cl√© API NuExtract est valid√©e avec la biblioth√®que `jsonwebtoken` pour s'assurer qu'elle respecte le format JWT standard attendu par l'API
- [2025-10-25] La validation utilise `jwt.decode()` avec l'option `{ complete: true }` pour d√©coder le JWT sans v√©rifier la signature (pas besoin de la cl√© publique de NuExtract)
- [2025-10-25] La validation v√©rifie :
  - Que le JWT contient bien 3 parties (header, payload, signature)
  - Que le header et le payload sont d√©codables en JSON valide
  - Que le header contient les champs requis `typ` et `alg`
- [2025-10-25] Cette validation est effectu√©e apr√®s le trim de la cl√© et avant toute utilisation pour appel API
- [2025-10-25] En cas d'erreur de validation, un message explicite est retourn√© : `API key format is invalid: {d√©tail erreur}. Script stopped.`

#### Justification pour la validation de la cl√© API

- **Validation robuste** : D√©tecte les JWT mal form√©s avant l'appel API (√©vite les requ√™tes inutiles avec cl√©s invalides comme `"1234"` ou `"a.b.c"`)
- **Standard de l'industrie** : `jsonwebtoken` est la biblioth√®que de r√©f√©rence pour JWT en Node.js (50M t√©l√©chargements/semaine)
- **Pas de cl√© publique n√©cessaire** : Le d√©codage sans v√©rification de signature suffit pour valider la structure
- **S√©curit√©** : D√©tection pr√©coce des erreurs de configuration (cl√© corrompue, fichier mal format√©)
- **Taille acceptable** : ~50KB de d√©pendance, n√©gligeable compar√© √† Jest/Babel d√©j√† pr√©sents

#### Patterns valid√©s pour la validation de la cl√© API

- **D√©codage sans v√©rification** : Utilisation de `jwt.decode(apiKey, { complete: true })` au lieu de `jwt.verify()`
- **Validation structurelle** : V√©rification que `decoded.header` et `decoded.payload` existent
- **Validation des champs requis** : V√©rification que `decoded.header.typ` et `decoded.header.alg` sont pr√©sents
- **Gestion d'erreur** : Encapsulation dans try-catch avec message explicite
- **S√©quence de validation** :
  1. Chargement de la cl√© (env var ou fichier)
  2. Trim des espaces
  3. V√©rification non vide
  4. Validation format JWT avec `jsonwebtoken`

#### Anti-Patterns pour la validation de la cl√© API √† √©viter

- **Validation simple par split** : √âviter `apiKey.split('.').length === 3` qui accepte `"a.b.c"` ‚Üí **Solution** : Utiliser `jsonwebtoken` ‚Üí **R√®gle √† adopter** : Validation structurelle compl√®te
- **V√©rification de signature** : √âviter `jwt.verify()` qui n√©cessite la cl√© publique ‚Üí **Solution** : Utiliser `jwt.decode()` ‚Üí **R√®gle √† adopter** : D√©codage sans v√©rification suffit
- **Validation manuelle base64** : √âviter de r√©inventer la roue avec Buffer.from() ‚Üí **Solution** : Utiliser `jsonwebtoken` ‚Üí **R√®gle √† adopter** : Utiliser biblioth√®que standard
- **Hardcodage JWT test** : √âviter les JWT de test cod√©s en dur dans le code ‚Üí **Solution** : Mocks dans les tests uniquement ‚Üí **R√®gle √† adopter** : Configuration externe pour production

#### √âtat d'impl√©mentation pour la validation de la cl√© API

‚úÖ [Fonctionnalit√© r√©alis√©e]

- ‚úÖ **Installation** : `jsonwebtoken` 9.0.2 ajout√© aux devDependencies
- ‚úÖ **Impl√©mentation** : Validation dans `loadApiKey()` de `nuextract-client.js`
- ‚úÖ **Tests BDD** : 4 sc√©narios passent (cl√© absente, cl√© vide, JWT invalide, chargement r√©ussi)

### R√©solution et validation des sch√©mas JSON

#### Description d√©taill√©e pour la r√©solution et validation des sch√©mas

- [2025-10-28] Les sch√©mas JSON avec r√©f√©rences `$ref` sont r√©solus et valid√©s avant utilisation pour g√©n√©ration de template
- [2025-10-28] **R√©solution des r√©f√©rences** : Utilisation de `@apidevtools/json-schema-ref-parser` pour r√©soudre automatiquement toutes les r√©f√©rences `$ref` dans un sch√©ma JSON monolithique
- [2025-10-28] **Validation conformit√©** : Utilisation de `Ajv` (avec `ajv-formats`) pour valider que le sch√©ma r√©solu est conforme √† JSON Schema Draft-07 (standard utilis√© dans le projet)
- [2025-10-28] Le sch√©ma r√©solu et valid√© est ensuite fusionn√© avec les instructions textuelles pour cr√©er la description envoy√©e √† l'API NuExtract
- [2025-10-28] Les erreurs de r√©solution ou validation sont contextualis√©es avec Error Cause (ES2022) pour pr√©server la tra√ßabilit√©

#### Justification pour la r√©solution et validation des sch√©mas

- **Modularit√©** : Permet de s√©parer les sch√©mas en fichiers distincts avec r√©f√©rences `$ref` pour faciliter la maintenance
- **Validation stricte** : Garantit que le sch√©ma respecte le standard JSON Schema Draft-07 avant utilisation
- **Tra√ßabilit√©** : Erreurs contextualis√©es avec Error Cause pour faciliter le d√©bogage
- **Standard reconnu** : `@apidevtools/json-schema-ref-parser` est la biblioth√®que standard pour r√©solution de r√©f√©rences JSON Schema
- **Validation robuste** : `Ajv` est la biblioth√®que de r√©f√©rence pour validation JSON Schema en JavaScript

#### Patterns valid√©s pour la r√©solution et validation des sch√©mas

- **R√©solution r√©f√©rences** : `const resolvedSchema = await $RefParser.dereference(mainSchemaFile, { dereference: { circular: 'ignore' } })`
- **Validation Draft-07** : `const metaSchema = require('ajv/dist/refs/json-schema-draft-07.json')` puis `ajv.compile(metaSchema)`
- **Gestion erreurs** : `throw new Error('Invalid JSON schema structure or content. Script stopped.', { cause: error })`
- **S√©quence** : R√©solution `$ref` ‚Üí Validation conformit√© ‚Üí Stringify pour fusion avec instructions

#### Anti-Patterns pour la r√©solution et validation des sch√©mas √† √©viter

- **R√©solution manuelle** : √âviter de r√©soudre manuellement les `$ref` avec boucles custom ‚Üí **Solution** : Utiliser `@apidevtools/json-schema-ref-parser` ‚Üí **R√®gle √† adopter** : Biblioth√®que standard
- **Validation absente** : √âviter d'utiliser un sch√©ma non valid√© ‚Üí **Solution** : Toujours valider avec Ajv ‚Üí **R√®gle √† adopter** : Validation obligatoire
- **Perte tra√ßabilit√©** : √âviter `throw new Error(error.message)` qui perd la stack ‚Üí **Solution** : Utiliser Error Cause ‚Üí **R√®gle √† adopter** : Error Cause pour wrapping

#### √âtat d'impl√©mentation pour la r√©solution et validation des sch√©mas

‚úÖ [Fonctionnalit√© r√©alis√©e - 2025-10-28]

- ‚úÖ **Biblioth√®que r√©solution** : `@apidevtools/json-schema-ref-parser` install√©e et int√©gr√©e
- ‚úÖ **Biblioth√®que validation** : `Ajv` + `ajv-formats` install√©es et int√©gr√©es
- ‚úÖ **Fonction loadAndResolveSchemas** : Refactoris√©e dans `nuextract-client.js` avec r√©solution et validation
- ‚úÖ **Tests BDD** : 4 sc√©narios passent (sch√©ma manquant, `$ref` manquant, JSON malform√©, sch√©ma non conforme)

### Gestion des modes de g√©n√©ration de template (sync/async)

#### Description d√©taill√©e pour la gestion des modes

- [2025-10-24] L'extraction supporte deux modes de g√©n√©ration de template via le param√®tre `templateMode` dans `extraction-config.json`
- [2025-10-24] **Mode sync** : Utilise `/api/infer-template` - traitement synchrone avec timeout HTTP global
- [2025-10-24] **Mode async** : Utilise `/api/infer-template-async` - traitement asynchrone avec polling de statut
- [2025-10-24] **Constat empirique** : L'API synchrone timeout √† ~11 secondes avec le sch√©ma `hermes2022-concepts.json` (4442 caract√®res) et retourne erreur 206 (Partial Content) avec body vide `{}`, tandis que l'API asynchrone permet de traiter le m√™me sch√©ma en 44 secondes avec succ√®s
- [2025-10-24] **Param√®tre unifi√© `templateGenerationDuration`** : Repr√©sente le temps estim√© de g√©n√©ration (d√©faut 30000ms)
  - **Mode sync** : Utilis√© comme base pour le timeout HTTP avec marge de s√©curit√© = `templateGenerationDuration + 5000`
  - **Mode async** : Utilis√© comme sleep initial avant le polling = `templateGenerationDuration`
- [2025-10-24] Le template g√©n√©r√© est sauvegard√© dans `shared/hermes2022-extraction-files/config/nuextract-template-generated/nuextract-template.json`

#### Justification pour la gestion des modes

- **Flexibilit√©** : Permet de choisir entre rapidit√© (sync pour petits sch√©mas) et fiabilit√© (async pour sch√©mas complexes >4000 caract√®res)
- **R√©sout les timeouts** : Le mode async r√©sout les timeouts syst√©matiques avec des sch√©mas JSON complexes
- **Gestion d'erreur explicite** : Message d'erreur clair en cas de timeout sync proposant de passer en mode async

#### Patterns valid√©s pour la gestion des modes

- **Param√®tre `templateMode`** : Valeurs accept√©es "sync" ou "async" (d√©faut "sync" si absent)
- **Param√®tre `templateGenerationDuration`** : Temps estim√© en ms (d√©faut 30000)
- **Param√®tres d'endpoints** : `infer-templatePath` et `infer-templateAsyncPath` dans configuration
- **Mode sync** :
  - Timeout HTTP = `templateGenerationDuration + 5000` ms
  - Pas de sleep, pas de retry
  - Template retourn√© directement dans la r√©ponse
  - Message d'erreur timeout explicite : "Timeout sync apr√®s Xms. Pour sch√©mas >4000 caract√®res, utilisez templateMode: 'async'"
- **Mode async** :
  - Timeout param√®tre API = 60 secondes (`?timeout=60s`)
  - Sleep initial = `templateGenerationDuration` ms
  - Polling interval = 3 secondes entre chaque v√©rification
  - Max attempts = 20 tentatives de polling
  - Workflow : POST `/api/infer-template-async?timeout=60s` ‚Üí obtenir jobId ‚Üí sleep ‚Üí polling GET `/api/jobs/{jobId}` ‚Üí r√©cup√©rer outputData
  - Statuts accept√©s : `"completed"` (succ√®s normal) ET `"timeout"` (succ√®s avec d√©passement timeout mais outputData pr√©sent)
  - Statut √©chec : `"failed"` (√©chec du job)
- **Format description** : Sch√©ma JSON en premier, puis instructions (sans headers/commentaires) ‚Äî Les instructions plac√©es avant le sch√©ma perturbent la g√©n√©ration du template
- **Limite taille** : 32k caract√®res pour le champ `description` selon support NuMind

#### Anti-Patterns pour la gestion des modes √† √©viter

- **Mode invalide** : √âviter templateMode ni "sync" ni "async" ‚Üí **Solution** : Validation stricte ‚Üí **R√®gle √† adopter** : Lever erreur explicite si valeur invalide
- **Utiliser mode sync pour sch√©mas >4000 caract√®res** : √âviter `/api/infer-template` pour gros sch√©mas ‚Üí **Solution** : Utiliser mode async ‚Üí **R√®gle √† adopter** : Workflow async pour sch√©mas complexes
- **Polling imm√©diat (async)** : √âviter de poller d√®s la soumission ‚Üí **Solution** : Sleep `templateGenerationDuration` initial ‚Üí **R√®gle √† adopter** : Laisser le temps au job de s'initialiser
- **Polling trop rapide (async)** : √âviter interval <2s ‚Üí **Solution** : Interval 3s ‚Üí **R√®gle √† adopter** : Limiter la charge sur l'API
- **Instructions avant sch√©ma** : √âviter headers/instructions avant le sch√©ma JSON ‚Üí **Solution** : Sch√©ma d'abord, instructions apr√®s ‚Üí **R√®gle √† adopter** : Format description = sch√©ma + instructions (sans headers)

#### √âtat d'impl√©mentation pour la gestion des modes

‚úÖ [Fonctionnalit√© r√©alis√©e]

### G√©n√©ration de template depuis configuration JSON centralis√©e

#### Description d√©taill√©e pour la g√©n√©ration de template depuis configuration JSON centralis√©e

- [2025-11-01] Les instructions de g√©n√©ration de template NuExtract sont d√©sormais centralis√©es dans `extraction-config.schema.json` sous `nuextract.templateTransformationInstructions`
- [2025-11-01] Le sch√©ma JSON Schema d√©finit toutes les valeurs possibles via le pattern `enum` (propri√©t√©s simples) et `items.enum` (arrays)
- [2025-11-01] La transformation sch√©ma ‚Üí config est r√©alis√©e par `transformSchemaToConfig()` qui extrait les valeurs par d√©faut depuis les `enum`
- [2025-11-01] Le config transform√© est valid√© avec Ajv avant utilisation pour garantir la conformit√© au sch√©ma
- [2025-11-01] Les instructions sont extraites directement depuis la config en m√©moire (`config.nuextract.templateTransformationInstructions.instructions`)
- [2025-11-01] SRP strict : Les instructions de g√©n√©ration de template font partie de l'impl√©mentation technique NuExtract, donc dans `extraction-config.schema.json` sous `nuextract`, PAS dans le sch√©ma conceptuel

#### Justification pour la g√©n√©ration de template depuis configuration JSON centralis√©e

- **Centralisation** : Configuration technique centralis√©e dans un seul fichier sch√©ma selon SRP
- **Param√©trage structur√©** : Pattern `enum` pour d√©finir toutes les valeurs possibles sans duplication
- **Type safety** : Validation JSON Schema avec Ajv garantit la conformit√© avant utilisation
- **Simplicit√©** : Plus de parsing Markdown, extraction directe depuis config en m√©moire
- **Historisation** : Le fichier `extraction-config.json` sera cr√©√© dans le r√©pertoire des donn√©es apr√®s extraction pour tra√ßabilit√©

#### Patterns valid√©s pour la g√©n√©ration de template depuis configuration JSON centralis√©e

- **Sch√©ma source** : `extraction-config.schema.json` avec toutes les propri√©t√©s et leurs `enum` possibles
- **Transformation** : `transformSchemaToConfig(schema)` qui parcourt r√©cursivement les propri√©t√©s
- **Pattern enum** :
  - **Propri√©t√©s simples** : `property.enum[0]` = valeur par d√©faut
  - **Arrays** : `property.items.enum` (array complet) = valeur par d√©faut
- **Validation Ajv** : Config transform√© valid√© avec le sch√©ma avant utilisation
- **Extraction instructions** : `config.nuextract.templateTransformationInstructions.instructions` (array joint avec `\n`)
- **Localisation SRP** : `templateTransformationInstructions` dans `extraction-config.schema.json` sous `nuextract`, PAS dans sch√©ma conceptuel

#### Anti-Patterns pour la g√©n√©ration de template depuis configuration JSON centralis√©e √† √©viter

- **Instructions dans sch√©ma conceptuel** : √âviter de placer `templateTransformationInstructions` dans `hermes2022-concepts.json` ‚Üí **Solution** : Configuration technique dans `extraction-config.schema.json` ‚Üí **R√®gle √† adopter** : SRP strict
- **Parsing Markdown** : √âviter de charger et parser `instructions-template-nuextract.md` ‚Üí **Solution** : Extraction depuis config en m√©moire ‚Üí **R√®gle √† adopter** : Pas de parsing inutile
- **Default JSON Schema** : √âviter d'utiliser `default` dans le sch√©ma ‚Üí **Solution** : Pattern `enum` uniquement ‚Üí **R√®gle √† adopter** : Enum comme source unique
- **Redondance enum** : √âviter de dupliquer les valeurs entre `enum` et `default` ‚Üí **Solution** : Uniquement `enum`, transformation manuelle ‚Üí **R√®gle √† adopter** : DRY

#### √âtat d'impl√©mentation pour la g√©n√©ration de template depuis configuration JSON centralis√©e

‚úÖ [Migration r√©alis√©e - 2025-11-01]

- ‚úÖ **Sch√©ma JSON Schema** : `extraction-config.schema.json` cr√©√© avec structure compl√®te et instructions migr√©es
- ‚úÖ **Fonction transformation** : `transformSchemaToConfig()` impl√©ment√©e avec logique enum[0] vs items.enum
- ‚úÖ **loadGlobalConfig()** : Modifi√© pour lire sch√©ma, transformer et valider avec Ajv
- ‚úÖ **loadInstructions()** : Modifi√© pour extraire depuis config en m√©moire (plus de parsing Markdown)
- ‚úÖ **Tests BDD** : Tous les tests unitaires et d'int√©gration passent (24/24 unitaires, 6/6 int√©gration)
- ‚úÖ **Nettoyage** : Fichiers obsol√®tes `instructions-template-nuextract.md` et `extraction-config.json` supprim√©s

### Cycle de vie de projet NuExtract

#### Description d√©taill√©e pour le cycle de vie de projet NuExtract

- 2025-10-24 Un projet est cr√©√© automatiquement par l'agent sp√©cialis√© Javascript si il n'existe pas encore sur la plateforme SaaS NuExtract pour le compte qui correspond √† la cl√© API configur√©e
- 2025-10-24 Le projet existant sur la plateforme SaaS NuExtract pour le compte qui correspond √† la cl√© API configur√©e qui correspond √† la d√©finition configur√©e est r√©utilis√©
- 2025-10-24 Le param√®tre `templateReset` dans `extraction-config.json` contr√¥le si le template d'un projet existant doit √™tre mis √† jour :
  - `templateReset: true` ‚Üí Le template est mis √† jour avec `putProjectTemplate` si le projet existe d√©j√†
  - `templateReset: false` ‚Üí Aucune mise √† jour, le projet existant est retourn√© tel quel
- 2025-10-24 La suppression de projet s'effectue sur la plateforme SaaS NuExtract pour le compte qui correspond √† la cl√© API configur√©e, elle n'est pas int√©gr√©e dans l'agent sp√©cialis√© Javascript

#### Justification pour le cycle de vie de projet NuExtract

- **Automatisation** : √âvite la cr√©ation manuelle de projets sur la plateforme SaaS
- **R√©utilisabilit√©** : Permet de r√©utiliser un projet existant avec son template et ses exemples
- **Simplicit√©** : Centralise la gestion dans l'agent JavaScript
- **S√©curit√©** : La suppression reste une op√©ration manuelle pour √©viter les pertes de donn√©es accidentelles

#### Patterns valid√©s pour le cycle de vie de projet NuExtract

- **Recherche avant cr√©ation** : Utiliser `getNuExtractProjects()` pour v√©rifier l'existence avant cr√©ation
- **Fonction unifi√©e** : `findOrCreateProject(apiKey, projectName, projectDescription, templateObj, templateReset)` g√®re automatiquement la recherche, cr√©ation et mise √† jour
- **Param√®tres configurables** : `projectName`, `projectDescription` et `templateReset` d√©finis dans `extraction-config.json`
- **Template obligatoire** : Un template est obligatoire pour la cr√©ation d'un nouveau projet, une erreur est lev√©e si `templateObj` est `null`
- **Contr√¥le mise √† jour** : Le param√®tre `templateReset` (boolean) d√©termine si le template d'un projet existant doit √™tre mis √† jour
- **Mise √† jour template** : `putProjectTemplate(apiKey, projectId, template)` appel√© automatiquement si `templateReset=true` et projet existant
- **Correspondance par nom** : Le projet est identifi√© par son nom (`projectName`) sur la plateforme
- **Retour structur√©** : La fonction retourne un objet `{ id, name, created?, updated? }` indiquant l'action effectu√©e

#### Anti-Patterns pour le cycle de vie de projet NuExtract √† √©viter

- **Cr√©ation sans v√©rification** : √âviter de cr√©er un projet sans v√©rifier son existence ‚Üí **Solution** : Utiliser `findOrCreateProject()` ‚Üí **R√®gle √† adopter** : Recherche syst√©matique avant cr√©ation
- **Cr√©ation sans template** : √âviter de cr√©er un projet sans template ‚Üí **Solution** : Toujours fournir un template valide ‚Üí **R√®gle √† adopter** : Template obligatoire pour cr√©ation
- **Suppression automatique** : √âviter la suppression programmatique de projets ‚Üí **Solution** : Suppression manuelle uniquement ‚Üí **R√®gle √† adopter** : Pr√©server les projets et leurs exemples sur la plateforme
- **Hardcodage du nom** : √âviter de coder en dur le nom du projet ‚Üí **Solution** : Param√©trer dans configuration ‚Üí **R√®gle √† adopter** : Utiliser `extraction-config.json`
- **Ignorer templateReset** : √âviter de toujours mettre √† jour ou jamais mettre √† jour ‚Üí **Solution** : Respecter le param√®tre `templateReset` ‚Üí **R√®gle √† adopter** : Contr√¥le explicite via configuration

#### √âtat d'impl√©mentation pour le cycle de vie de projet NuExtract

üöß [Fonctions impl√©ment√©es, tests BDD √† compl√©ter]

### Structure et format des instructions d'extraction

#### Description d√©taill√©e pour la structure et format des instructions d'extraction

- [2025-08-16] Les instructions d'extraction utilisent le format Markdown pour optimiser l'utilisation par l'IA
- [2025-08-16] Un fichier d'instructions s√©par√© est cr√©√© pour chaque concept HERMES2022 √† extraire (phases, sc√©narios, modules, t√¢ches, r√©sultats, r√¥les)
- [2025-08-16] Les instructions se concentrent uniquement sur la transformation, pas sur la d√©finition de la structure cible
- [2025-08-16] La structure cible est d√©finie par les sch√©mas JSON des fichiers interm√©diaires, cr√©ant un contrat d'interface entre extraction et consommation
- [2015-10-18] Les pages html de r√©f√©rence pour un concept sont d√©clar√©es dans une propri√©t√© sourceURL de type caract√®re associ√©e √† une √©num√©ration pour la liste qui est √† concat√©n√©e pour la former la cha√Æne de caract√®re √† l'ex√©cution pour journaliser les pages effectivement utilis√©es lors de la cr√©ation du fichier interm√©diaire. Le sch√©ma JSON sert √† la fois de d√©finition de la propri√©t√© de journalisation et de param√®tre avec l'√©num√©ration.

#### Justification pour la structure et format des instructions d'extraction

- **Format Markdown** : Naturel pour l'IA, instructions conversationnelles claires
- **Fichiers s√©par√©s** : Maintenance facilit√©e, lisibilit√© optimale, √©volution ind√©pendante par concept
- **S√©paration des responsabilit√©s** : Instructions d'extraction ‚â† d√©finition structure cible
- **Contrat d'interface** : Synchronisation progressive entre instructions et sch√©mas cibles

#### Patterns valid√©s pour la structure et format des instructions d'extraction

- **Un fichier par concept** : `/config/extraction-{concept}.md` pour chaque concept HERMES2022
- **Instructions conversationnelles** : Prompts naturels adapt√©s √† l'IA
- **Synchronisation progressive** : √âvolution conjointe des instructions et des sch√©mas cibles
- **Validation par sch√©ma** : Contr√¥le de conformit√© via JSON Schema des fichiers interm√©diaires

#### Anti-Patterns pour la structure et format des instructions d'extraction √† √©viter

- **Fichier monolithique** : √âviter un seul fichier pour tous les concepts ‚Üí **Solution** : Fichiers s√©par√©s par concept ‚Üí **R√®gle √† adopter** : Modularit√© conceptuelle
- **M√©lange des responsabilit√©s** : √âviter de d√©finir la structure cible dans les instructions ‚Üí **Solution** : S√©paration claire extraction/structure ‚Üí **R√®gle √† adopter** : Contrat d'interface via sch√©mas
- **Format technique** : √âviter JSON/YAML pour les instructions ‚Üí **Solution** : Markdown conversationnel ‚Üí **R√®gle √† adopter** : Instructions naturelles pour l'IA

#### √âtat d'impl√©mentation pour la structure et format des instructions d'extraction

üöß [En cours de conception et r√©alisation]

### Contrat d'interface extraction-fichiers interm√©diaires

#### Description d√©taill√©e pour le contrat d'interface

- [2025-08-16] Un contrat d'interface est √©tabli entre les instructions d'extraction et les sch√©mas des fichiers interm√©diaires, il consiste surtout √† v√©rifier et faire se synchroniser les d√©finitions dans les sp√©cifications respectives par l'IA
- [2025-08-16] La synchronisation se fait progressivement au fur et √† mesure de l'√©volution des besoins
- [2025-08-16] Les sch√©mas JSON des fichiers interm√©diaires d√©finissent la structure cible de la transformation

#### Justification pour le contrat d'interface

- **Coh√©rence** : Garantit l'alignement entre extraction et consommation
- **√âvolutivit√©** : Permet l'adaptation progressive des deux c√¥t√©s
- **Validation** : Assure la conformit√© des donn√©es extraites
- **Maintenance** : Facilite la gestion des changements

#### Patterns valid√©s pour le contrat d'interface

- **Synchronisation progressive** : √âvolution conjointe des instructions et sch√©mas
- **Validation automatique** : Contr√¥le de conformit√© via JSON Schema
- **Documentation partag√©e** : R√©f√©rence commune pour l'√©quipe

#### √âtat d'impl√©mentation pour le contrat d'interface

üöß [En cours de sp√©cification et r√©alisation]

### Visa humain d'overview pour hermes2022-concepts

#### Description d√©taill√©e pour le visa humain d'overview

- [2025-08-19] La qualit√© du champ `overview` des concepts HERMES2022 est valid√©e manuellement via un fichier d'approbation (sidecar) adjacent √† l'artefact JSON produit.
- [2025-08-19] Le visa est consign√© par √©l√©ments/r√®gles √† contr√¥ler (statuts par item) avec des m√©tadonn√©es globales uniques (reviewer, date, notes).

#### Justification pour le visa humain d'overview

- La conformit√© structurelle est assur√©e par JSON Schema; la qualit√© s√©mantique de `overview` requiert un jugement humain.
- La mat√©rialisation explicite du visa am√©liore la tra√ßabilit√© et l'auditabilit√© sans sur‚Äëing√©nierie.

#### Patterns valid√©s pour le visa humain d'overview

- **Sidecar d'approbation**: Fichier sidecar adjacent nomm√© comme l'artefact avec suffixe `.approval.json` g√©n√©r√© par l'IA en post extraction
- **Sch√©ma d'approbation**: `shared/hermes2022-extraction-files/config/json-schemas/hermes2022-concepts-approval.json`.
- **Structure du visa**:
  - M√©tadonn√©es globales: `artifact`, `reviewer`, `date`, `notes?`.
  - D√©tails par item: `target`, `rule`, `status` (`approved|rejected|pending`), `lastChecked`, `comment?`, `evidence?`.
- **Initialisation status approbation** : Cible √† valider g√©n√©r√©es selon liste ci-dessous avec status "pending" pour les cibles √† valider en post extraction

**Cibles √† valider par revue humaine (format JSON Pointer)** :

- `/concepts/overview`

#### Anti-Patterns pour le visa humain d'overview √† √©viter

- **Visa global unique**: √©viter un statut global sans granularit√© par r√®gle/cible.
- **Absence de sch√©ma**: √©viter des fichiers d'approbation non valid√©s.

#### √âtat d'impl√©mentation pour le visa humain d'overview

‚úÖ Sch√©ma d'approbation cr√©√©: `shared/hermes2022-extraction-files/config/json-schemas/hermes2022-concepts-approval.json`
üöß Int√©gration dans le flux d'extraction/validation BDD √† compl√©ter

### Param√©trage du r√©pertoire des artefacts (artifactBaseDir)

#### Description d√©taill√©e

- [2025-08-20] Ajout d‚Äôune propri√©t√© `artifactBaseDir` dans `config/extraction-config.json` pour orienter l‚Äôoutillage (tests BDD inclus) vers un r√©pertoire unique d‚Äôartefacts sans recherche multiple.
- Valeur: chemin relatif au r√©pertoire `hermes2022-concepts-site-extraction/` (chemin absolu accept√©).
- Objectif: permette l'ex√©cution avec des fixtures pour attester les fonctionnement des tests sans cr√©er de sur consommation de ressources (alternative syst√©matique avec fallback)

#### Justification

- S√ªret√©: les tests restent strictement conformes aux sch√©mas; tra√ßabilit√© inchang√©e.
- Durabilit√©: supprime les recherches/fallbacks redondants (√©conomie CPU/IO).
- Gouvernance: distingue explicitement les jeux d‚Äôattestation (`__tests__/fixtures/...`) des donn√©es ‚Äúr√©elles‚Äù (`shared/.../data/`) par configuration, pas par heuristique.

#### Patterns valid√©s

- R√©pertoire unique pilot√© par `artifactBaseDir`.
- Sidecar d‚Äôapprobation adjacent et r√©solu depuis le m√™me r√©pertoire.
- Override optionnel via variable d‚Äôenvironnement `HERMES_CONCEPTS_ARTIFACT_DIR` (si pr√©sent, prioritaire sur `artifactBaseDir`).

#### Anti-Patterns (√† √©viter)

- Recherche multi-emplacements implicite (fixtures ‚Üí shared) dans le code des steps.
- D√©nominations sp√©ciales dans les noms de fichiers (la distinction se fait par le r√©pertoire).
- Couplage fort aux chemins en dur dans les steps.

#### √âtat d'impl√©mentation

üöß √Ä impl√©menter dans les steps BDD et la configuration

### Format du template NuExtract g√©n√©r√© par l'API

#### Description d√©taill√©e pour le format du template NuExtract

- [2025-10-21] L'API `/api/infer-template-async` transforme un sch√©ma JSON Schema en template NuExtract avec des r√®gles de conversion sp√©cifiques
- [2025-10-21] **Fixture de r√©f√©rence** : Template valide obtenu de la plateforme SaaS disponible dans `__tests__/fixtures/nuextract-template-valid.json`
- [2025-10-21] **Types de base** : `"type": "string"` ‚Üí `"string"`, `"type": "string", "pattern": "..."` ‚Üí `"verbatim-string"`, `"type": "string", "format": "date"` ‚Üí `"date-time"`
- [2025-10-21] **√ânum√©rations** : Les `enum` JSON Schema sont converties en **tableaux** dans le template NuExtract (ex: `"enum": ["de", "fr", "it", "en"]` ‚Üí `["de", "fr", "it", "en"]`)
- [2025-10-21] **Tableaux** : Les `"type": "array"` JSON Schema sont repr√©sent√©s avec **un seul √©l√©ment type** dans le template
- [2025-10-21] **R√©f√©rences $ref** : Les r√©f√©rences sont **r√©solues et int√©gr√©es** dans le template final (pas de `$ref` dans le template NuExtract)

#### Justification pour le format du template NuExtract

- **Interop√©rabilit√©** : Format standardis√© NuExtract pour les extractions futures
- **Validation** : Template valid√© par la plateforme SaaS garantit la conformit√©
- **Tests** : Fixture de r√©f√©rence permet la validation automatis√©e des g√©n√©rations de template
- **Documentation par l'exemple** : Template valide sert de r√©f√©rence pour comprendre les transformations

#### Patterns valid√©s pour le format du template NuExtract

- **Conversion √©num√©rations** : `"language": {"type": "string", "enum": ["de", "fr", "it", "en"]}` ‚Üí `"language": ["de", "fr", "it", "en"]`
- **Types NuExtract** : `"verbatim-string"` pour patterns, `"string"` pour texte libre, `"date-time"` pour dates
- **R√©solution r√©f√©rences** : `"concept-phases": {"$ref": "./hermes2022-phases.json"}` ‚Üí structure compl√®te int√©gr√©e
- **Arrays template** : `"phases": [{"id": "verbatim-string", "name": "string", ...}]` (un seul √©l√©ment type)
- **Fixture de test** : `__tests__/fixtures/nuextract-template-valid.json` comme r√©f√©rence pour validation

#### Anti-Patterns pour le format du template NuExtract √† √©viter

- **$ref non r√©solues** : √âviter de laisser des `$ref` dans le template ‚Üí **Solution** : R√©soudre toutes les r√©f√©rences avant envoi √† l'API ‚Üí **R√®gle √† adopter** : Utiliser le sch√©ma r√©solu complet
- **√ânum√©rations non converties** : √âviter de tester avec `"enum": [...]` dans template ‚Üí **Solution** : Valider que les √©num√©rations sont des tableaux ‚Üí **R√®gle √† adopter** : Tests BDD v√©rifient la conversion
- **Structure array incorrecte** : √âviter plusieurs √©l√©ments types dans array ‚Üí **Solution** : Un seul √©l√©ment type ‚Üí **R√®gle √† adopter** : Format NuExtract standard

#### √âtat d'impl√©mentation pour le format du template NuExtract

‚úÖ [Fixture valid√©e et tests adapt√©s]

- ‚úÖ **Fixture de r√©f√©rence** : `__tests__/fixtures/nuextract-template-valid.json` cr√©√©e depuis plateforme SaaS
- ‚úÖ **Tests BDD am√©lior√©s** : Validation de la structure, des √©num√©rations converties, des types NuExtract, et de la r√©solution des `$ref`
- üöß **API retourne template vide** : Investigation en cours avec NuMind sur pourquoi l'API retourne `{}` alors que la plateforme SaaS fonctionne correctement
